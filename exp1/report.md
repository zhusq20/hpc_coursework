# MPI 异步通信小作业 实验报告 

 朱思齐 2020011851

## 任务一

InfiniBand:


| 编号 | 消息长度 | 延迟 (us) | 带宽(MB/s) |
| ---- | -------- | ------ | ------ |
| 1    | 1        | 1.31       | 4.38       |
| 2    | 2        | 1.26       | 8.95       |
| 3    | 4        | 1.24       | 17.61       |
| 4    | 8        | 1.23       | 36.44       |
| 5    | 16       | 1.23       | 71.46       |
| 6    | 32       | 1.29       | 145.94       |
| 7    | 64       | 1.43       | 230.68       |
| 8    | 128      | 1.53       | 329.51       |
| 9    | 256      | 2.21       | 499.63       |
| 10   | 512      | 2.25       | 1138.93       |
| 11   | 1024     | 2.55       | 1820.77       |
| 12   | 2048     | 3.07       | 2828.19       |
| 13   | 4096     | 4.10       | 3837.51       |
| 14   | 8192     | 5.91       | 4821.65       |
| 15   | 16384    | 7.85       | 5080.20       |
| 16   | 32768    | 10.91       | 10844.79       |
| 17   | 65536    | 17.90       | 11628.51       |
| 18   | 131072   | 33.03       | 11837.22       |
| 19   | 262144   | 33.37       | 11953.30       |
| 20   | 524288   | 58.59       | 12010.04       |
| 21   | 1048576  | 100.08       | 12035.71       |
| 22   | 2097152  | 187.75       | 12051.73       |
| 23   | 4194304  | 362.92       | 12058.59       |

以太网：


| 编号 | 消息长度 | 延迟 (us) | 带宽(MB/s) |
| ---- | -------- | ------ | ------ |
| 1    | 1        | 45.00       | 0.31       |
| 2    | 2        | 45.05       | 0.62       |
| 3    | 4        | 44.93       | 1.22       |
| 4    | 8        | 45.19       | 2.39       |
| 5    | 16       | 45.22       | 4.99       |
| 6    | 32       | 45.49       | 9.03       |
| 7    | 64       | 46.44       | 16.17       |
| 8    | 128      | 47.96       | 34.15       |
| 9    | 256      | 52.59       | 54.31       |
| 10   | 512      | 58.41       | 80.17       |
| 11   | 1024     | 70.23       | 95.46       |
| 12   | 2048     | 87.88       | 104.93       |
| 13   | 4096     | 109.76       | 110.70       |
| 14   | 8192     | 185.24       | 114.07       |
| 15   | 16384    | 214.95       | 116.01       |
| 16   | 32768    | 363.57       | 116.83       |
| 17   | 65536    | 635.72       | 117.14       |
| 18   | 131072   | 1198.39       | 117.34       |
| 19   | 262144   | 2414.00       | 117.52       |
| 20   | 524288   | 4645.50       | 117.57       |
| 21   | 1048576  | 9090.20       | 117.60       |


- 请描述当消息长度增加时，带宽和延迟分别呈现出什么样的趋势？

1. 带宽：先随着消息长度线性增加，随后增速减缓。

2. 延迟：消息长度小于128时延迟几乎不增加，随后增速变快。

- 该趋势在两种网络下有何不同？

1. 带宽：InfiniBand的带宽增长更为显著，且峰值带宽远高于以太网。InfiniBand设计用于高性能计算和数据中心环境，支持更高的数据传输率和更低的延迟。以太网虽然在带宽上也随消息长度增加而增加，但其增长速度和峰值带宽都显著低于InfiniBand。

2. 延迟：InfiniBand的延迟增长相对较平缓，且整体延迟水平明显低于以太网，这反映了其设计上的高效性和对高性能要求的满足。相比之下，以太网的延迟增长更为明显，特别是在传输大数据包时，延迟的增加更为显著。

- 为什么会有这样的趋势？

1. 带宽：较大的数据包减少了每单位数据传输所需的开销（如头部信息），使得网络能够更高效地传输数据。也就是说，网络在传输较大的数据块时，更接近于其峰值传输能力。

2. 延迟：增加主要是因为更大的数据包需要更多的时间来进行处理、传输和确认。

- 对比InfiniBand和以太网络下的带宽和延迟，它们之间的差距是多少？

1. 带宽：InfiniBand是以太网的10-100倍。

2. 延迟：以太网是InfiniBand的30-50倍。

## 任务二

| 编号 | 消息长度  | 计算量 | mpi_sync 总耗时 | mpi_async  总耗时 |
| ---- | --------- | ------ | --------------- | ----------------- |
| 1    | 100000000 | 10     | 807.525            | 841.804              |
| 2    | 100000000 | 20     | 877.367            | 743.711              |
| 3    | 100000000 | 40     | 1278.22            | 845.185              |
| 4    | 100000000 | 80     | 1681.06            | 844.842              |
| 5    | 100000000 | 160    | 2482.78            | 1600.54              |

- 通信时间和计算时间满足什么关系时，非阻塞通信程序能完美掩盖通信时间？

在计算时间为160ms的情况下，Wait Request时间为0.136262ms，几乎接近于零。这意味着当计算时间足够长，非阻塞通信程序能够几乎完美地掩盖通信时间。

- 简述两份代码的不同之处。

mpi_async.cpp使用了mpi_isend/mpi_irecv和mpi_wait
mpi_sync.cpp使用了mpi_send/mpi_recv

